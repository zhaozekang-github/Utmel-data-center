import{c as e,e as a,l,d as t,r as o,S as i,o as s,Y as r,w as d,g as n,X as u,a1 as m,W as p,m as c,aL as f,Z as g,t as v,at as _,aC as h,dp as y,$ as b,a0 as j}from"./index.Buyu3njk.js";import{v as k}from"./el-loading.DxUxpi7-.js";import{E as w}from"./el-scrollbar.Cu2msVTx.js";import{E as V}from"./el-tree.BraUYeL7.js";import"./el-checkbox.B5b_Jz-d.js";import{E as x}from"./el-dialog.DbryiCq8.js";import{E as C}from"./el-input-number.DeJjfaiD.js";import{_ as U,E,a as S}from"./refresh.3ZItKhR7.js";/* empty css               */import{E as R,a as z}from"./el-select.8_InoF5O.js";import"./el-popper.BfVBGKk4.js";import{E as q}from"./el-card.CaBNoqdo.js";import{_ as N}from"./index.ZJpo3Td-.js";import{E as F,a as B}from"./el-table-column.CVWMIrBT.js";import"./el-tooltip.l0sNRNKZ.js";import{_ as I,a as L}from"./delete.0IIXIgsN.js";import{_ as A}from"./plus.CgQ2C7TA.js";import{a as O,E as T}from"./el-form-item.B1EC_3Ji.js";import{_ as M}from"./search.BHW2NzeT.js";import{R as P}from"./index.CGjB9IUg.js";import{E as W}from"./index.DdOiTB_p.js";import"./index.CquR4N0Z.js";import"./isEqual.ZGBuoL13.js";import"./_Uint8Array.CYseMYDv.js";import"./use-dialog.1bzcfXgI.js";import"./isUndefined.DgmxjSXK.js";import"./refs.C2OHdTAj.js";import"./strings.DYMDfDiy.js";import"./debounce.BSlwRXJD.js";import"./_baseIteratee.BtCZdpFB.js";import"./index.BtWKdmvV.js";import"./castArray.N1xzF4QI.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.7QVjqoR1.js";const X={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Y=[l("path",{fill:"currentColor",d:"m249.6 417.088l319.744 43.072l39.168 310.272L845.12 178.88zm-129.024 47.168a32 32 0 0 1-7.68-61.44l777.792-311.04a32 32 0 0 1 41.6 41.6l-310.336 775.68a32 32 0 0 1-61.44-7.808L512 516.992z"},null,-1)];const Z={name:"ep-position",render:function(l,t){return e(),a("svg",X,[...Y])}},$={class:"app-container"},D={class:"search-container"},J={class:"dialog-footer"},K={class:"dialog-footer"},Q=t({name:"Role",inheritAttrs:!1,__name:"index",setup(t){const X=o(O),Y=o(O),Q=o(V),G=o(!1),H=o([]),ee=o(0),ae=i({pageNum:1,pageSize:10}),le=o(),te=i({title:"",visible:!1}),oe=i({sort:1,status:1,code:"",name:""}),ie=i({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),se=o(!1),re=o([]);let de=i({});function ne(){G.value=!0,P.getPage(ae).then((e=>{le.value=e.list,ee.value=e.total})).finally((()=>{G.value=!1}))}function ue(){X.value.resetFields(),ae.pageNum=1,ne()}function me(e){H.value=e.map((e=>e.id))}function pe(e){te.visible=!0,e?(te.title="修改角色",P.getFormData(e).then((e=>{Object.assign(oe,e)}))):te.title="新增角色"}function ce(){Y.value.validate((e=>{if(e){G.value=!0;const e=oe.id;e?P.update(e,oe).then((()=>{_.success("修改成功"),fe(),ue()})).finally((()=>G.value=!1)):P.add(oe).then((()=>{_.success("新增成功"),fe(),ue()})).finally((()=>G.value=!1))}}))}function fe(){te.visible=!1,Y.value.resetFields(),Y.value.clearValidate(),oe.id=void 0,oe.sort=1,oe.status=1}function ge(e){const a=[e||H.value].join(",");a?h.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{G.value=!0,P.deleteByIds(a).then((()=>{_.success("删除成功"),ue()})).finally((()=>G.value=!1))})):_.warning("请勾选删除项")}function ve(){const e=de.id;if(e){const a=Q.value.getCheckedNodes(!1,!0).map((e=>e.value));G.value=!0,P.updateRoleMenus(e,a).then((()=>{_.success("分配权限成功"),se.value=!1,ue()})).finally((()=>{G.value=!1}))}}return s((()=>{ne()})),(t,o)=>{const i=b,s=T,_=M,h=j,_e=U,he=O,ye=A,be=I,je=F,ke=W,we=Z,Ve=L,xe=B,Ce=N,Ue=q,Ee=R,Se=z,Re=E,ze=S,qe=C,Ne=x,Fe=V,Be=w,Ie=k;return e(),a("div",$,[l("div",D,[r(he,{ref_key:"queryFormRef",ref:X,model:n(ae),inline:!0},{default:d((()=>[r(s,{prop:"keywords",label:"关键字"},{default:d((()=>[r(i,{modelValue:n(ae).keywords,"onUpdate:modelValue":o[0]||(o[0]=e=>n(ae).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:u(ne,["enter"])},null,8,["modelValue"])])),_:1}),r(s,null,{default:d((()=>[r(h,{type:"primary",onClick:ne},{default:d((()=>[r(_),m("搜索")])),_:1}),r(h,{onClick:ue},{default:d((()=>[r(_e),m("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),r(Ue,{shadow:"never",class:"table-container"},{header:d((()=>[r(h,{type:"success",onClick:o[1]||(o[1]=e=>pe())},{default:d((()=>[r(ye),m("新增")])),_:1}),r(h,{type:"danger",disabled:0===n(H).length,onClick:o[2]||(o[2]=e=>ge())},{default:d((()=>[r(be),m("删除")])),_:1},8,["disabled"])])),default:d((()=>[p((e(),c(xe,{ref:"dataTableRef",data:n(le),"highlight-current-row":"",border:"",onSelectionChange:me},{default:d((()=>[r(je,{type:"selection",width:"55",align:"center"}),r(je,{label:"角色名称",prop:"name","min-width":"100"}),r(je,{label:"角色编码",prop:"code",width:"150"}),r(je,{label:"状态",align:"center",width:"100"},{default:d((a=>[1===a.row.status?(e(),c(ke,{key:0,type:"success"},{default:d((()=>[m("正常")])),_:1})):(e(),c(ke,{key:1,type:"info"},{default:d((()=>[m("禁用")])),_:1}))])),_:1}),r(je,{label:"排序",align:"center",width:"80",prop:"sort"}),r(je,{fixed:"right",label:"操作",width:"220"},{default:d((e=>[r(h,{type:"primary",size:"small",link:"",onClick:a=>async function(e){const a=e.id;a&&(de={id:a,name:e.name},se.value=!0,G.value=!0,re.value=await y.getOptions(),P.getRoleMenuIds(a).then((e=>{e.forEach((e=>Q.value.setChecked(e,!0,!1)))})).finally((()=>{G.value=!1})))}(e.row)},{default:d((()=>[r(we),m("分配权限 ")])),_:2},1032,["onClick"]),r(h,{type:"primary",size:"small",link:"",onClick:a=>pe(e.row.id)},{default:d((()=>[r(Ve),m("编辑 ")])),_:2},1032,["onClick"]),r(h,{type:"primary",size:"small",link:"",onClick:a=>ge(e.row.id)},{default:d((()=>[r(be),m("删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Ie,n(G)]]),n(ee)>0?(e(),c(Ce,{key:0,total:n(ee),"onUpdate:total":o[3]||(o[3]=e=>f(ee)?ee.value=e:null),page:n(ae).pageNum,"onUpdate:page":o[4]||(o[4]=e=>n(ae).pageNum=e),limit:n(ae).pageSize,"onUpdate:limit":o[5]||(o[5]=e=>n(ae).pageSize=e),onPagination:ne},null,8,["total","page","limit"])):g("",!0)])),_:1}),r(Ne,{modelValue:n(te).visible,"onUpdate:modelValue":o[11]||(o[11]=e=>n(te).visible=e),title:n(te).title,width:"500px",onClose:fe},{footer:d((()=>[l("div",J,[r(h,{type:"primary",onClick:ce},{default:d((()=>[m("确 定")])),_:1}),r(h,{onClick:fe},{default:d((()=>[m("取 消")])),_:1})])])),default:d((()=>[r(he,{ref_key:"roleFormRef",ref:Y,model:n(oe),rules:n(ie),"label-width":"100px"},{default:d((()=>[r(s,{label:"角色名称",prop:"name"},{default:d((()=>[r(i,{modelValue:n(oe).name,"onUpdate:modelValue":o[6]||(o[6]=e=>n(oe).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),r(s,{label:"角色编码",prop:"code"},{default:d((()=>[r(i,{modelValue:n(oe).code,"onUpdate:modelValue":o[7]||(o[7]=e=>n(oe).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),r(s,{label:"数据权限",prop:"dataScope"},{default:d((()=>[r(Se,{modelValue:n(oe).dataScope,"onUpdate:modelValue":o[8]||(o[8]=e=>n(oe).dataScope=e)},{default:d((()=>[(e(),c(Ee,{key:0,label:"全部数据",value:0})),(e(),c(Ee,{key:1,label:"部门及子部门数据",value:1})),(e(),c(Ee,{key:2,label:"本部门数据",value:2})),(e(),c(Ee,{key:3,label:"本人数据",value:3}))])),_:1},8,["modelValue"])])),_:1}),r(s,{label:"状态",prop:"status"},{default:d((()=>[r(ze,{modelValue:n(oe).status,"onUpdate:modelValue":o[9]||(o[9]=e=>n(oe).status=e)},{default:d((()=>[r(Re,{label:1},{default:d((()=>[m("正常")])),_:1}),r(Re,{label:0},{default:d((()=>[m("停用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(s,{label:"排序",prop:"sort"},{default:d((()=>[r(qe,{modelValue:n(oe).sort,"onUpdate:modelValue":o[10]||(o[10]=e=>n(oe).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),r(Ne,{modelValue:n(se),"onUpdate:modelValue":o[13]||(o[13]=e=>f(se)?se.value=e:null),title:"【"+n(de).name+"】权限分配",width:"800px"},{footer:d((()=>[l("div",K,[r(h,{type:"primary",onClick:ve},{default:d((()=>[m("确 定")])),_:1}),r(h,{onClick:o[12]||(o[12]=e=>se.value=!1)},{default:d((()=>[m("取 消")])),_:1})])])),default:d((()=>[p((e(),c(Be,{"max-height":"600px"},{default:d((()=>[r(Fe,{ref_key:"menuRef",ref:Q,"node-key":"value","show-checkbox":"",data:n(re),"default-expand-all":!0},{default:d((({data:e})=>[m(v(e.label),1)])),_:1},8,["data"])])),_:1})),[[Ie,n(G)]])])),_:1},8,["modelValue","title"])])}}});export{Q as default};
